<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">


    <changeSet id="create_basic_table_and_constraint_and_insert" author="Vladimir-Panchenko">
        <sql>
            create table device (
            device_type_id bigint not null,
            id bigint generated by default as identity,
            user_id bigint,
            model varchar(255),
            serial_number varchar(255),
            primary key (id));

            create table device_module (
            device_id bigint not null,
            module_id bigint not null);

            create table device_type (
            id bigint generated by default as identity,
            last_updated timestamp(6) with time zone,
            type varchar(255),
            primary key (id));

            create table module (
            id bigint generated by default as identity,
            last_updated timestamp(6) with time zone,
            name varchar(255),
            serial_number varchar(255),
            primary key (id));

            alter table if exists device
            add constraint device_type_id_key
            foreign key (device_type_id)
            references device_type;

            alter table if exists device_module
            add constraint module_id_key
            foreign key (device_id)
            references module;

            alter table if exists device_module
            add constraint device_id_key
            foreign key (module_id)
            references device;

            INSERT INTO device_type
            (id, last_updated, "type")
            VALUES(1, '2024-09-21 22:34:29.429', 'Moisture resistant');

            INSERT INTO "module"
            (id, last_updated, "name", serial_number)
            VALUES(1, '2024-09-21 22:34:29.429', 'Temperature sensor', '#333333');

            INSERT INTO device
            (device_type_id, id, user_id, model, serial_number)
            VALUES(1, 1, 1, NULL, '#232323');

            INSERT INTO device_module
            (device_id, module_id)
            VALUES(1, 1);

        </sql>

    </changeSet>
</databaseChangeLog>